import{r as d,S as v,b as I,j as t}from"./index-Du1wZ1pu.js";import{T as S}from"./Title-CaBRCAqF.js";import{u as D}from"./usePageMetadata-CED4SOpM.js";import{a as h}from"./productImages-rNWg_BiP.js";const P=()=>{const{token:g,currency:b,ensureProductLoaded:y,productMap:p}=d.useContext(v),[l,N]=d.useState([]),[m,j]=d.useState({}),x=d.useCallback(async()=>{try{if(!g)return;const{data:e}=await I.post("/api/order/userorders");if(e.success){const a=[];(e.orders||[]).forEach(r=>{(r.items||[]).forEach(i=>{a.push({...i,status:r.status,payment:r.payment,paymentMethod:r.paymentMethod,date:r.date})})}),N(a.reverse())}}catch(e){console.error("loadOrderData failed",e)}},[g]);d.useEffect(()=>{x()},[x]),d.useEffect(()=>{const e=new Set,a={};let r=!1;if(l.forEach(n=>{const s=String(n.product||n.productId||n._id||"");if(!s)return;const c=typeof n.image=="string"&&n.image.trim();if(c){m[s]!==c&&(a[s]=c,r=!0);return}const u=p.get(s),o=h(u);if(o){m[s]!==o&&(a[s]=o,r=!0);return}m[s]||e.add(s)}),r&&j(n=>({...n,...a})),!e.size)return;let i=!1;return(async()=>{const n=await Promise.all(Array.from(e).map(async s=>{try{const c=await y(s);return[s,h(c)]}catch(c){return console.error("Failed to load product for order",s,c),[s,null]}}));i||j(s=>{let c=!1;const u={...s};return n.forEach(([o,f])=>{o&&f&&u[o]!==f&&(u[o]=f,c=!0)}),c?u:s})})(),()=>{i=!0}},[l,y,p,m]);const w=d.useMemo(()=>({absoluteCanonical:e,baseTitle:a,pageDescription:r})=>[{"@context":"https://schema.org","@type":"ProfilePage","@id":`${e}#orders`,url:e,name:a,description:r,mainEntity:{"@type":"ItemList",numberOfItems:l.length}}],[l.length]);return D({title:"Your TinyMillion Orders",description:"Track TinyMillion purchases, check fulfilment statuses, and revisit past order details in one place.",keywords:"TinyMillion orders, track shipment, order history",canonical:"/orders",robots:"noindex, nofollow",structuredData:w}),t.jsxs("div",{className:"border-t pt-16",children:[t.jsx("div",{className:"text-2xl",children:t.jsx(S,{text1:"MY",text2:"ORDERS"})}),t.jsx("div",{children:l.map((e,a)=>{const r=String(e.product||e.productId||e._id||a),i=typeof e.image=="string"&&e.image.trim(),n=m[r]||h(p.get(r)),s=i||n||null;return t.jsxs("div",{className:"py-4 border-t border-b text-gray-700 flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[t.jsxs("div",{className:"flex items-start gap-6 text-sm",children:[s?t.jsx("img",{className:"w-16 sm:w-20 object-cover",src:s,alt:e.name||"Ordered product",loading:"lazy",decoding:"async"}):t.jsx("div",{className:"w-16 sm:w-20 bg-gray-100 flex items-center justify-center text-xs",children:"No image"}),t.jsxs("div",{children:[t.jsx("p",{className:"sm:text-base font-medium",children:e.name}),t.jsxs("div",{className:"flex items-center gap-3 mt-1 text-base text-gray-700",children:[t.jsxs("p",{children:[b,e.price]}),t.jsxs("p",{children:["Quantity: ",e.quantity]}),t.jsxs("p",{children:["Size: ",e.size]})]}),t.jsxs("p",{className:"mt-1",children:["Date: ",t.jsx("span",{className:" text-gray-400",children:new Date(e.date).toDateString()})]}),t.jsxs("p",{className:"mt-1",children:["Payment: ",t.jsx("span",{className:" text-gray-400",children:e.paymentMethod})]})]})]}),t.jsxs("div",{className:"md:w-1/2 flex justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("p",{className:"min-w-2 h-2 rounded-full bg-green-500"}),t.jsx("p",{className:"text-sm md:text-base",children:e.status})]}),t.jsx("button",{onClick:x,className:"border px-4 py-2 text-sm font-medium rounded-sm",children:"Track Order"})]})]},`${e._id||a}-${a}`)})})]})};export{P as default};
