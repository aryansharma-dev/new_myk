import{u as $,r as t,S as A,c as R,j as s}from"./index-Du1wZ1pu.js";import{g as P,a as F}from"./productImages-rNWg_BiP.js";import{u as L}from"./usePageMetadata-CED4SOpM.js";const J=()=>{const{productId:l}=$(),{productMap:o,ensureProductLoaded:p,currency:S,addToCart:C}=t.useContext(A),j=R(),[e,a]=t.useState(()=>l&&(o==null?void 0:o.get(String(l)))||null),[T,d]=t.useState(""),[f,b]=t.useState(""),[z,m]=t.useState(!e),[N,c]=t.useState(null),u=t.useRef(null);t.useEffect(()=>{b("")},[l]),t.useEffect(()=>{if(!l){a(null),d(""),m(!1),c("Invalid product");return}const r=String(l),n=o==null?void 0:o.get(r);if(n){a(n),m(!1),c(null);return}m(!0),c(null),(async()=>{try{if(u.current){await u.current;return}const i=p(r);u.current=i;const x=await i;if(!x){c("Product not found."),a(null);return}a(x),c(null)}catch(i){console.error("Failed to load product",i),c((i==null?void 0:i.message)||"Failed to load product."),a(null)}finally{u.current=null,m(!1)}})()},[l,o,p]),t.useEffect(()=>{if(!e){d("");return}const r=P(e);d(n=>n&&r.includes(n)?n:r[0]||"")},[e]);const v=t.useMemo(()=>String((e==null?void 0:e.category)||"").trim().toLowerCase(),[e==null?void 0:e.category]),g=t.useMemo(()=>["jewellery","jewelry","jewelery"].includes(v),[v]),M=t.useMemo(()=>P(e),[e]),h=T||F(e),w=t.useMemo(()=>Array.isArray(e==null?void 0:e.sizes)?e.sizes.filter(r=>typeof r=="string"&&r.trim().length>0):[],[e==null?void 0:e.sizes]),k=t.useMemo(()=>e!=null&&e.description?e.description:e!=null&&e.name?`Shop ${e.name} online from TinyMillion.`:"Explore product details from TinyMillion.",[e]),E=t.useMemo(()=>{if(!e)return;const r=Number(e.price),n=Number.isFinite(r)?{"@type":"Offer",priceCurrency:"INR",price:r,availability:"https://schema.org/InStock"}:void 0;return({absoluteCanonical:y,pageDescription:i,absoluteImage:x})=>[{"@context":"https://schema.org","@type":"Product","@id":`${y}#product`,url:y,name:e.name||"TinyMillion Product",description:i,image:x,category:e.category,brand:"TinyMillion",offers:n}]},[e]);if(L({title:(e==null?void 0:e.name)||"Product Details",description:k,keywords:`${(e==null?void 0:e.name)||"TinyMillion product"}, TinyMillion product details, buy online`,canonical:`/product/${l}`,image:h,structuredData:E}),z)return s.jsx("div",{className:"p-8",children:"Loading product details..."});if(N)return s.jsxs("div",{className:"p-8",children:[s.jsx("p",{className:"text-red-500 mb-4",children:N}),s.jsx("button",{type:"button",onClick:()=>j("/collection"),className:"underline text-sm",children:"Browse other products"})]});if(!e)return s.jsx("div",{className:"p-8",children:"Product unavailable."});const I=async()=>{if(!g&&!f){alert("Please select a size before adding to cart");return}const r=g?void 0:f;try{await C(e==null?void 0:e._id,r,e==null?void 0:e.category),j("/cart")}catch(n){console.error("Failed to add item to cart",n)}};return s.jsx("div",{className:"border-t-2 pt-10",children:s.jsxs("div",{className:"flex flex-col gap-8 sm:flex-row sm:items-start sm:gap-12",children:[s.jsx("div",{className:"w-full sm:basis-1/5 sm:shrink-0",children:s.jsx("div",{className:"flex gap-3 overflow-x-auto sm:flex-col sm:overflow-y-auto sm:max-h-[520px] pr-1",children:M.map((r,n)=>s.jsx("img",{src:r,onClick:()=>d(r),alt:`${(e==null?void 0:e.name)||"Product"} thumbnail ${n+1}`,loading:"lazy",decoding:"async",className:"h-20 w-20 sm:h-24 sm:w-24 object-cover rounded cursor-pointer flex-none border"},n))})}),s.jsxs("div",{className:"w-full sm:basis-4/5",children:[h&&s.jsx("img",{src:h,alt:(e==null?void 0:e.name)||"Product",loading:"eager",decoding:"async",fetchPriority:"high",className:"w-[300px] sm:w-[70%] h-auto object-cover rounded mx-auto mb-6"}),s.jsx("h1",{className:"font-medium text-2xl mt-2",children:(e==null?void 0:e.name)||"Product"}),s.jsxs("p",{className:"mt-5 text-3xl font-medium",children:[S,(e==null?void 0:e.price)??""]}),s.jsx("p",{className:"mt-5 text-gray-500 md:w-4/5",children:(e==null?void 0:e.description)||"Product details will be updated soon."}),!g&&w.length>0&&s.jsxs("div",{className:"flex flex-col gap-4 my-8",children:[s.jsx("p",{children:"Select Size"}),s.jsx("div",{className:"flex gap-2",children:w.map((r,n)=>s.jsx("button",{onClick:()=>b(r),className:`border py-2 px-4 bg-gray-100 ${r===f?"border-orange-500":""}`,children:r},n))})]}),s.jsx("button",{onClick:I,className:"bg-black text-white px-8 py-3 text-sm active:bg-gray-700",children:"ADD TO CART"}),s.jsx("hr",{className:"mt-8 sm:w-4/5"}),s.jsxs("div",{className:"text-sm text-gray-500 mt-5 flex flex-col gap-1",children:[s.jsx("p",{children:"100% Original product."}),s.jsx("p",{children:"Cash on delivery is available on this product."}),s.jsx("p",{children:"Easy return and exchange policy within 7 days."})]})]})]})})};export{J as default};
