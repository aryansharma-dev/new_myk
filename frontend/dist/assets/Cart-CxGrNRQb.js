import{r as n,S as N,j as t,a as w}from"./index-Du1wZ1pu.js";import{T as C}from"./Title-CaBRCAqF.js";import{C as P}from"./CartTotal-BLd9aFHe.js";import{a as _}from"./productImages-rNWg_BiP.js";import{u as S}from"./usePageMetadata-CED4SOpM.js";const I=()=>{const{currency:h,cartItems:l,updateQuantity:u,navigate:p,token:y,getCartCount:j,getCartSummary:b,productMap:o,ensureProductLoaded:g}=n.useContext(N),a=n.useMemo(()=>{const e=[];for(const s in l)for(const r in l[s]){const c=l[s][r];c>0&&e.push({_id:s,size:r,quantity:c})}return e},[l]);n.useEffect(()=>{const e=a.map(s=>String(s._id)).filter(s=>s&&!o.has(s));e.length&&Promise.all(e.map(s=>g(s))).catch(s=>{console.error("Failed to load cart product",s)})},[a,o,g]);const i=b(),x=n.useMemo(()=>a.some(e=>!o.has(String(e._id))),[a,o]),d=j()>0&&i.subtotal>0&&!x,v=n.useMemo(()=>({absoluteCanonical:e,baseTitle:s,pageDescription:r})=>[{"@context":"https://schema.org","@type":"ShoppingCart","@id":`${e}#cart`,url:e,name:s,description:r,numberOfItems:a.length,potentialAction:{"@type":"CheckoutAction",target:`${e.replace("/cart","")}/checkout`},offers:{"@type":"AggregateOffer",priceCurrency:"INR",lowPrice:Number(i.subtotal||0),highPrice:Number(i.total||i.subtotal||0),offerCount:a.length}}],[a.length,i.subtotal,i.total]);return S({title:"Your Shopping Cart",description:"Review the items saved in your TinyMillion cart and update sizes or quantities before placing your order.",keywords:"TinyMillion cart, review order, checkout preparation, saved items",canonical:"/cart",robots:"noindex, nofollow",structuredData:v}),t.jsxs("div",{className:"p-4 md:px-8",children:[t.jsx(C,{title:"Cart"}),t.jsxs("div",{children:[a.map((e,s)=>{const r=o.get(String(e._id)),c=_(r),f=!r;return t.jsxs("div",{className:"py-4 border-t border-b text-gray-700 grid grid-cols-[4fr_0.5fr_0.5fr] sm:grid-cols-[4fr_2fr_0.5fr] items-center gap-4",children:[t.jsxs("div",{className:"flex items-start gap-6",children:[c?t.jsx("img",{className:"w-16 sm:w-20 object-cover",src:c,alt:(r==null?void 0:r.name)||"Product",loading:"lazy",decoding:"async"}):t.jsx("div",{className:"w-16 sm:w-20 bg-gray-100 flex items-center justify-center text-xs",children:"No image"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs sm:text-lg font-medium",children:(r==null?void 0:r.name)||(f?"Loading product…":"Product")}),t.jsxs("div",{className:"flex items-center gap-5 mt-2",children:[t.jsxs("p",{children:[h,(r==null?void 0:r.price)??(f?"--":0)]}),t.jsx("p",{className:"px-2 sm:px-3 sm:py-1 border bg-slate-50",children:e.size})]})]})]}),t.jsx("input",{onChange:m=>{m.target.value===""||m.target.value==="0"||u(e._id,e.size,Number(m.target.value))},className:"border max-w-10 sm:max-w-20 px-1 sm:px-2 py-1",type:"number",min:1,defaultValue:e.quantity}),t.jsx("img",{onClick:()=>u(e._id,e.size,0),className:"w-4 mr-4 sm:w-5 cursor-pointer",src:w.bin_icon,alt:"remove",loading:"lazy",decoding:"async"})]},`${e._id}-${e.size}-${s}`)}),!a.length&&t.jsx("div",{className:"py-10 text-center text-gray-500",children:"Your cart is empty."}),x&&a.length>0&&t.jsx("div",{className:"py-4 text-sm text-gray-500",children:"Refreshing product details…"})]}),t.jsx("div",{className:"flex justify-end my-20",children:t.jsxs("div",{className:"w-full sm:w-[450px]",children:[t.jsx(P,{}),t.jsx("div",{className:"w-full text-end",children:t.jsx("button",{onClick:()=>y?p("/place-order"):p("/login",{state:{from:"/place-order"}}),disabled:!d,className:`bg-black text-white text-sm my-8 px-8 py-3 ${d?"":"opacity-60 cursor-not-allowed"}`,title:d?"Proceed to Checkout":"Add items to your cart first",children:"PROCEED TO CHECKOUT"})})]})})]})};export{I as default};
